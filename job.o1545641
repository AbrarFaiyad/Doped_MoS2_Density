Activating conda environment: fair
========================================
MoS2 NPT Simulation Runner
========================================
Starting MoS2 NPT simulation...
Simulation started at: Mon Jul 14 18:14:07 PDT 2025
/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torchtnt/utils/version.py:12: UserWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html. The pkg_resources package is slated for removal as early as 2025-11-30. Refrain from using this package or pin to Setuptools<81.
  import pkg_resources
/home/afaiyad/.local/lib/python3.11/site-packages/ase/md/nvtberendsen.py:98: RuntimeWarning: divide by zero encountered in scalar divide
  1.0 + (self.temperature / old_temperature - 1.0) * tautscl
ERROR:root:Error edge_vec_0_distance: 5.731658925283616e-15
ERROR:root:Error edge_vec_0_distance: 1.7053025658242404e-12
WARNING:root:PBCv2: graph generation encountered a very large box. The size of the cell is tensor([[[ 4.3349e+12,  0.0000e+00,  0.0000e+00],
         [-2.1674e+12,  3.7541e+12,  0.0000e+00],
         [ 0.0000e+00,  0.0000e+00,  3.4788e+12]]], device='cuda:0',
       grad_fn=<AddBackward0>) and min/max positions are (tensor(-1.8530e+12, device='cuda:0'), tensor(4.1181e+12, device='cuda:0')). Performance will be slower than optimal.
WARNING:root:PBCv2: Does this system require PBC=True or will PBC=False work?
============================================================
MoS2 NPT SIMULATION
============================================================
Initializing MoS2 NPT simulation:
  - Layers: 8
  - Supercell size: 10x10
  - Temperature: 300 K
  - Pressure: 1.0 atm (101325 Pa)
  - Timestep: 1.0 fs

==================================================
SETTING UP FAIRCHEM CALCULATOR
==================================================
Loading UMA-S-1.1 model...
✓ Fairchem calculator initialized successfully

==================================================
BUILDING MoS2 STRUCTURE
==================================================
Building 8-layer MoS2 with 10x10 supercells...
Building MoS2 structure using ASE's mx2 function:
  - Supercell: 10x10
  - Layers: 8
  - Lattice parameter a: 3.18 Å
  - Vacuum: 0.00 Å
✓ Structure created with 2400 atoms
  - Mo atoms: 800
  - S atoms: 1600
  - Cell: 31.80 x 27.54 x 25.52 Å
  - Volume: 22349.38 Å³
✓ Structure built successfully:
  - Total atoms: 2400
  - Mo atoms: 800
  - S atoms: 1600
  - Cell dimensions: 31.80 x 27.54 x 25.52 Å
  - Cell volume: 22349.38 Å³
  - Initial density: 9.514 g/cm³
✓ Initial structure saved as 'initial_structure.xyz'

==================================================
RUNNING NPTBerendsen SIMULATION
==================================================
Simulation parameters:
  - Steps: 50000
  - Temperature: 300 K
  - Pressure: 101325 Pa
  - Timestep: 1.0 fs
  - Log interval: 100
  - Trajectory interval: 100
Pressure conversion:
  - Pressure in Pa: 101325
  - Pressure in atomic units: 6.32e-07 eV/Å³
  - Compressibility: 7.32e+01 Å³/eV

Starting NPT simulation...
Error during NPT simulation: No edges found in input system, this means either you have a single atom in the system or the atoms are farther apart than the radius cutoff of the model of 6 Angstroms. We don't know how to handle this case. Check the positions of system: tensor([[2.1674e+12, 3.7541e+12, 2.1744e+11],
        [2.1674e+11, 1.2514e+11, 4.3488e+11],
        [2.3760e+12, 4.2903e+11, 4.7962e+08],
        ...,
        [1.9507e+12, 3.3787e+12, 3.2614e+12],
        [1.6378e+12, 3.4986e+12, 3.4783e+12],
        [2.1674e+12, 3.5038e+12, 3.0439e+12]], device='cuda:0',
       grad_fn=<AddBackward0>)

Simulation failed with error: No edges found in input system, this means either you have a single atom in the system or the atoms are farther apart than the radius cutoff of the model of 6 Angstroms. We don't know how to handle this case. Check the positions of system: tensor([[2.1674e+12, 3.7541e+12, 2.1744e+11],
        [2.1674e+11, 1.2514e+11, 4.3488e+11],
        [2.3760e+12, 4.2903e+11, 4.7962e+08],
        ...,
        [1.9507e+12, 3.3787e+12, 3.2614e+12],
        [1.6378e+12, 3.4986e+12, 3.4783e+12],
        [2.1674e+12, 3.5038e+12, 3.0439e+12]], device='cuda:0',
       grad_fn=<AddBackward0>)
Traceback (most recent call last):
  File "/mnt/borgstore/amartini/afaiyad/Doped_MoS2_density/results/mos2_npt_simulation.py", line 402, in <module>
    main()
  File "/mnt/borgstore/amartini/afaiyad/Doped_MoS2_density/results/mos2_npt_simulation.py", line 377, in main
    results = sim.run_npt_simulation(
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "/mnt/borgstore/amartini/afaiyad/Doped_MoS2_density/results/mos2_npt_simulation.py", line 280, in run_npt_simulation
    dyn.run(steps=steps)
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/md/md.py", line 171, in run
    return Dynamics.run(self, steps=steps)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/optimize/optimize.py", line 286, in run
    for converged in Dynamics.irun(self, steps=steps):
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/optimize/optimize.py", line 257, in irun
    self.step()
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/md/nptberendsen.py", line 191, in step
    forces = self.atoms.get_forces(md=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/atoms.py", line 829, in get_forces
    forces = self._calc.get_forces(self)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/calculators/abc.py", line 32, in get_forces
    return self.get_property('forces', atoms)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.local/lib/python3.11/site-packages/ase/calculators/calculator.py", line 515, in get_property
    self.calculate(atoms, [name], system_changes)
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/calculate/ase_calculator.py", line 218, in calculate
    pred = self.predictor.predict(batch)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/units/mlip_unit/predict.py", line 44, in collated_predict
    preds = predict_fn(predict_unit, data, undo_element_references)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/units/mlip_unit/predict.py", line 233, in predict
    output = self.model(data_device)
             ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/optim/swa_utils.py", line 242, in forward
    return self.module(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/models/base.py", line 178, in forward
    emb = self.backbone(data)
          ^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1739, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/nn/modules/module.py", line 1750, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/common/utils.py", line 71, in cls_method
    return f(self, *args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/torch/utils/_contextlib.py", line 116, in decorate_context
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/afaiyad/.conda/envs/fair/lib/python3.11/site-packages/fairchem/core/models/uma/escn_md.py", line 446, in forward
    raise ValueError(
ValueError: No edges found in input system, this means either you have a single atom in the system or the atoms are farther apart than the radius cutoff of the model of 6 Angstroms. We don't know how to handle this case. Check the positions of system: tensor([[2.1674e+12, 3.7541e+12, 2.1744e+11],
        [2.1674e+11, 1.2514e+11, 4.3488e+11],
        [2.3760e+12, 4.2903e+11, 4.7962e+08],
        ...,
        [1.9507e+12, 3.3787e+12, 3.2614e+12],
        [1.6378e+12, 3.4986e+12, 3.4783e+12],
        [2.1674e+12, 3.5038e+12, 3.0439e+12]], device='cuda:0',
       grad_fn=<AddBackward0>)
Simulation completed successfully at: Mon Jul 14 18:14:22 PDT 2025
Results saved in: /home/afaiyad/borgstore/Doped_MoS2_density/results
========================================
Simulation Complete
========================================
